<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body class="m-3">
    <h1 class="text-center">Articulos</h1>

    <button id="createButton" class="btn btn-success">Crear artículo</button>
    <!-- Tabla para las lineas -->
    <table class="table text-center">
        <thead class="bg-primary text-white">
            <tr>
                <th>CodArticulo</th>
                <th>Descripcion</th>
                <th>Precio</th>
                <th>Existencia</th>
                <th>Maximo</th>
                <th>Minimo</th>
                <th>StatusA</th>
                <th>FechaDesincorporacion</th>
            </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
    </table>


    <!-- Modal crear articulo-->
<!-- Modal -->
<div class="modal fade" id="addArticleModal" tabindex="-1" role="dialog" aria-labelledby="addArticleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addArticleModalLabel">Agregar nuevo artículo</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="addArticleForm">
            <div class="form-group">
              <label for="CodArticulo">Código de artículo</label>
              <input type="text" class="form-control" id="CodArticulo" required>
            </div>
            <div class="form-group">
              <label for="Descripcion">Descripción</label>
              <input type="text" class="form-control" id="Descripcion" required>
            </div>
            <div class="form-group">
              <label for="CodLinea">Código de línea</label>
              <input type="number" class="form-control" id="CodLinea" required>
            </div>
            <div class="form-group">
              <label for="Precio">Precio</label>
              <input type="number" step="0.01" class="form-control" id="Precio" required>
            </div>
            <div class="form-group">
              <label for="Existencia">Existencia</label>
              <input type="number" class="form-control" id="Existencia" required>
            </div>
            <div class="form-group">
              <label for="Maximo">Máximo</label>
              <input type="number" class="form-control" id="Maximo" required>
            </div>
            <div class="form-group">
              <label for="Minimo">Mínimo</label>
              <input type="number" class="form-control" id="Minimo" required>
            </div>
            <div class="form-group">
              <label for="StatusA">Estado</label>
              <select class="form-control" id="StatusA" required>
                <option value="A">A</option>
                <option value="D">D</option>
                <option value="R">R</option>
              </select>
            </div>
            <div class="form-group">
              <label for="FechaDesincorporacion">Fecha de desincorporación</label>
              <input type="date" class="form-control" id="FechaDesincorporacion">
            </div>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </form>
        </div>
      </div>
    </div>
  </div>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        function updateTable() {
            // Limpiar la tabla
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            let params = new URLSearchParams(window.location.search);
            let id = params.get('id');

            //*****************GET ARTICULOS
            fetch(`http://localhost:8000/getarticulos/${id}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${item.CodArticulo}</td><td>${item.Descripcion}</td><td>${item.Precio}</td>
                                         <td>${item.Existencia}</td><td>${item.Maximo}</td><td>${item.Minimo}</td>
                                         <td>${item.StatusA}</td><td>${item.FechaDesincorporacion}</td>`;
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            updateTable();
        });
    </script>

    <script>
        //*****************Crear un articulo
        document.addEventListener('DOMContentLoaded', (event) => {
    document.getElementById('createButton').addEventListener('click', function () {
        $('#addArticleModal').modal('show');
    });

    document.getElementById('addArticleForm').addEventListener('submit', function (event) {
        event.preventDefault();

        let CodArticulo = document.getElementById('CodArticulo').value;
        let Descripcion = document.getElementById('Descripcion').value;
        let CodLinea = document.getElementById('CodLinea').value;
        let Precio = document.getElementById('Precio').value;
        let Existencia = document.getElementById('Existencia').value;
        let Maximo = document.getElementById('Maximo').value;
        let Minimo = document.getElementById('Minimo').value;
        let StatusA = document.getElementById('StatusA').value;
        let FechaDesincorporacion = document.getElementById('FechaDesincorporacion').value;

        let data = {
            CodArticulo: CodArticulo,
            Descripcion: Descripcion,
            CodLinea: CodLinea,
            Precio: Precio,
            Existencia: Existencia,
            Maximo: Maximo,
            Minimo: Minimo,
            StatusA: StatusA,
            FechaDesincorporacion: FechaDesincorporacion
        };

        fetch('http://localhost:8000/postarticulo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                $('#addArticleModal').modal('hide');
                updateTable();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    });
});
    </script>
</body>

</html>